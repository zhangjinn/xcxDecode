"use strict";

//Tokenizer.js
function Tokenizer(cbs) {
  this._state = "TEXT";
  this._buffer = "";
  this._sectionStart = 0;
  this._index = 0;
  this._cbs = cbs;
}
Tokenizer.prototype.TEXT = function (c) {
  var index = this._buffer.indexOf("<", this._index);
  if (index != -1) {
    this._index = index;
    this._cbs.ontext(this._getSection());
    this._state = "BeforeTag";
    this._sectionStart = this._index;
  } else this._index = this._buffer.length;
};
Tokenizer.prototype.BeforeTag = function (c) {
  switch (c) {
    case "/":
      this._state = "BeforeCloseTag";
      break;
    case "!":
      this._state = "BeforeDeclaration";
      break;
    case "?":
      var index = this._buffer.indexOf(">", this._index);
      if (index != -1) {
        this._index = index;
        this._sectionStart = this._index + 1;
      } else this._sectionStart = this._index = this._buffer.length;
      this._state = "TEXT";
      break;
    case ">":
      this._state = "TEXT";
      break;
    case "<":
      this._cbs.ontext(this._getSection());
      this._sectionStart = this._index;
      break;
    default:
      if (/\s/.test(c)) this._state = "TEXT";else {
        this._state = "InTag";
        this._sectionStart = this._index;
      }
  }
};
Tokenizer.prototype.InTag = function (c) {
  if (c === "/" || c === ">" || /\s/.test(c)) {
    this._cbs.onopentagname(this._getSection());
    this._state = "BeforeAttrsName";
    this._index--;
  }
};
Tokenizer.prototype.BeforeAttrsName = function (c) {
  if (c === ">") {
    this._cbs.onopentagend();
    this._state = "TEXT";
    this._sectionStart = this._index + 1;
  } else if (c === "/") {
    this._state = "InSelfCloseTag";
  } else if (!/\s/.test(c)) {
    this._state = "InAttrsName";
    this._sectionStart = this._index;
  }
};
Tokenizer.prototype.InAttrsName = function (c) {
  if (c === "=" || c === "/" || c === ">" || /\s/.test(c)) {
    this._cbs._attribname = this._getSection().toLowerCase();
    this._sectionStart = -1;
    this._state = "AfterAttrsName";
    this._index--;
  }
};
Tokenizer.prototype.AfterAttrsName = function (c) {
  if (c === "=") {
    this._state = "BeforeAttrsValue";
  } else if (c === "/" || c === ">") {
    this._cbs.onattribend();
    this._state = "BeforeAttrsName";
    this._index--;
  } else if (!/\s/.test(c)) {
    this._cbs.onattribend();
    this._state = "InAttrsName";
    this._sectionStart = this._index;
  }
};
Tokenizer.prototype.BeforeAttrsValue = function (c) {
  if (c === '"') {
    this._state = "InAttrsValueDQ";
    this._sectionStart = this._index + 1;
  } else if (c === "'") {
    this._state = "InAttrsValueSQ";
    this._sectionStart = this._index + 1;
  } else if (!/\s/.test(c)) {
    this._state = "InAttrsValueNQ";
    this._sectionStart = this._index;
    this._index--;
  }
};
Tokenizer.prototype.InAttrsValueDQ = function (c) {
  if (c === '"') {
    this._cbs._attribvalue += this._getSection();
    this._cbs.onattribend();
    this._state = "BeforeAttrsName";
  }
};
Tokenizer.prototype.InAttrsValueSQ = function (c) {
  if (c === "'") {
    this._cbs._attribvalue += this._getSection();
    this._cbs.onattribend();
    this._state = "BeforeAttrsName";
  }
};
Tokenizer.prototype.InAttrsValueNQ = function (c) {
  if (/\s/.test(c) || c === ">") {
    this._cbs._attribvalue += this._getSection();
    this._cbs.onattribend();
    this._state = "BeforeAttrsName";
    this._index--;
  }
};
Tokenizer.prototype.BeforeCloseTag = function (c) {
  if (/\s/.test(c)) ;else if (c === ">") {
    this._state = "TEXT";
  } else {
    this._state = "InCloseTag";
    this._sectionStart = this._index;
  }
};
Tokenizer.prototype.InCloseTag = function (c) {
  if (c === ">" || /\s/.test(c)) {
    this._cbs.onclosetag(this._getSection());
    this._state = "AfterCloseTag";
    this._index--;
  }
};
Tokenizer.prototype.InSelfCloseTag = function (c) {
  if (c === ">") {
    this._cbs.onopentagend();
    this._state = "TEXT";
    this._sectionStart = this._index + 1;
  } else if (!/\s/.test(c)) {
    this._state = "BeforeAttrsName";
    this._index--;
  }
};
Tokenizer.prototype.AfterCloseTag = function (c) {
  if (c === ">") {
    this._state = "TEXT";
    this._sectionStart = this._index + 1;
  }
};
Tokenizer.prototype.BeforeDeclaration = function (c) {
  if (c == '-') this._state = "InComment";else if (c == '[') this._state = "BeforeCDATA1";else this._state = "InDeclaration";
};
Tokenizer.prototype.InDeclaration = function (c) {
  var index = this._buffer.indexOf(">", this._index);
  if (index != -1) {
    this._index = index;
    this._sectionStart = index + 1;
  } else this._sectionStart = this._index = this._buffer.length;
  this._state = "TEXT";
};
Tokenizer.prototype.InComment = function (c) {
  var key = c == '-' ? '-->' : '>';
  var index = this._buffer.indexOf(key, this._index);
  if (index != -1) {
    this._index = index + key.length - 1;
    this._sectionStart = this._index + 1;
  } else this._sectionStart = this._index = this._buffer.length;
  this._state = "TEXT";
};
Tokenizer.prototype.BeforeCDATA1 = function (c) {
  if (c == 'C') this._state = "BeforeCDATA2";else this._state = "InDeclaration";
};
Tokenizer.prototype.BeforeCDATA2 = function (c) {
  if (c == 'D') this._state = "BeforeCDATA3";else this._state = "InDeclaration";
};
Tokenizer.prototype.BeforeCDATA3 = function (c) {
  if (c == 'A') this._state = "BeforeCDATA4";else this._state = "InDeclaration";
};
Tokenizer.prototype.BeforeCDATA4 = function (c) {
  if (c == 'T') this._state = "BeforeCDATA5";else this._state = "InDeclaration";
};
Tokenizer.prototype.BeforeCDATA5 = function (c) {
  if (c == 'A') this._state = "InCDATA";else this._state = "InDeclaration";
};
Tokenizer.prototype.InCDATA = function (c) {
  var key = c == '[' ? ']]>' : '>';
  var index = this._buffer.indexOf(key, this._index);
  if (index != -1) {
    this._index = index + key.length - 1;
    this._sectionStart = this._index + 1;
  } else this._sectionStart = this._index = this._buffer.length;
  this._state = "TEXT";
};
Tokenizer.prototype.parse = function (chunk) {
  this._buffer += chunk;
  for (; this._index < this._buffer.length; this._index++) {
    this[this._state](this._buffer[this._index]);
  }if (this._state === "TEXT" && this._sectionStart !== this._index) this._cbs.ontext(this._buffer.substr(this._sectionStart));
  this._cbs.onend();
};
Tokenizer.prototype._getSection = function () {
  return this._buffer.substring(this._sectionStart, this._index);
};
module.exports = Tokenizer;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlRva2VuaXplci5qcyJdLCJuYW1lcyI6WyJUb2tlbml6ZXIiLCJjYnMiLCJfc3RhdGUiLCJfYnVmZmVyIiwiX3NlY3Rpb25TdGFydCIsIl9pbmRleCIsIl9jYnMiLCJwcm90b3R5cGUiLCJURVhUIiwiYyIsImluZGV4IiwiaW5kZXhPZiIsIm9udGV4dCIsIl9nZXRTZWN0aW9uIiwibGVuZ3RoIiwiQmVmb3JlVGFnIiwidGVzdCIsIkluVGFnIiwib25vcGVudGFnbmFtZSIsIkJlZm9yZUF0dHJzTmFtZSIsIm9ub3BlbnRhZ2VuZCIsIkluQXR0cnNOYW1lIiwiX2F0dHJpYm5hbWUiLCJ0b0xvd2VyQ2FzZSIsIkFmdGVyQXR0cnNOYW1lIiwib25hdHRyaWJlbmQiLCJCZWZvcmVBdHRyc1ZhbHVlIiwiSW5BdHRyc1ZhbHVlRFEiLCJfYXR0cmlidmFsdWUiLCJJbkF0dHJzVmFsdWVTUSIsIkluQXR0cnNWYWx1ZU5RIiwiQmVmb3JlQ2xvc2VUYWciLCJJbkNsb3NlVGFnIiwib25jbG9zZXRhZyIsIkluU2VsZkNsb3NlVGFnIiwiQWZ0ZXJDbG9zZVRhZyIsIkJlZm9yZURlY2xhcmF0aW9uIiwiSW5EZWNsYXJhdGlvbiIsIkluQ29tbWVudCIsImtleSIsIkJlZm9yZUNEQVRBMSIsIkJlZm9yZUNEQVRBMiIsIkJlZm9yZUNEQVRBMyIsIkJlZm9yZUNEQVRBNCIsIkJlZm9yZUNEQVRBNSIsIkluQ0RBVEEiLCJwYXJzZSIsImNodW5rIiwic3Vic3RyIiwib25lbmQiLCJzdWJzdHJpbmciLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOztBQUFBO0FBQ0EsU0FBU0EsU0FBVCxDQUFtQkMsR0FBbkIsRUFBd0I7QUFDdEIsT0FBS0MsTUFBTCxHQUFjLE1BQWQ7QUFDQSxPQUFLQyxPQUFMLEdBQWUsRUFBZjtBQUNBLE9BQUtDLGFBQUwsR0FBcUIsQ0FBckI7QUFDQSxPQUFLQyxNQUFMLEdBQWMsQ0FBZDtBQUNBLE9BQUtDLElBQUwsR0FBWUwsR0FBWjtBQUNEO0FB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UyxDQUFDLENBQWQsRUFBaUI7QUFDZixTQUFLTCxNQUFMLEdBQWNLLFFBQVE2QixJQUFJekIsTUFBWixHQUFxQixDQUFuQztBQUNBLFNBQUtWLGFBQUwsR0FBcUIsS0FBS0MsTUFBTCxHQUFjLENBQW5DO0FBQ0QsR0FIRCxNQUdPLEtBQUtELGFBQUwsR0FBcUIsS0FBS0MsTUFBTCxHQUFjLEtBQUtGLE9BQUwsQ0FBYVcsTUFBaEQ7QUFDUCxPQUFLWixNQUFMLEdBQWMsTUFBZDtBQUNELENBUkQ7QUFTQUYsVUFBVU8sU0FBVixDQUFvQnVDLEtBQXBCLEdBQTRCLFVBQVNDLEtBQVQsRUFBZ0I7QUFDMUMsT0FBSzVDLE9BQUwsSUFBZ0I0QyxLQUFoQjtBQUNBLFNBQU8sS0FBSzFDLE1BQUwsR0FBYyxLQUFLRixPQUFMLENBQWFXLE1BQWxDLEVBQTBDLEtBQUtULE1BQUwsRUFBMUM7QUFDRSxTQUFLLEtBQUtILE1BQVYsRUFBa0IsS0FBS0MsT0FBTCxDQUFhLEtBQUtFLE1BQWxCLENBQWxCO0FBREYsR0FFQSxJQUFJLEtBQUtILE1BQUwsS0FBZ0IsTUFBaEIsSUFBMEIsS0FBS0UsYUFBTCxLQUF1QixLQUFLQyxNQUExRCxFQUNFLEtBQUtDLElBQUwsQ0FBVU0sTUFBVixDQUFpQixLQUFLVCxPQUFMLENBQWE2QyxNQUFiLENBQW9CLEtBQUs1QyxhQUF6QixDQUFqQjtBQUNGLE9BQUtFLElBQUwsQ0FBVTJDLEtBQVY7QUFDRCxDQVBEO0FBUUFqRCxVQUFVTyxTQUFWLENBQW9CTSxXQUFwQixHQUFrQyxZQUFXO0FBQzNDLFNBQU8sS0FBS1YsT0FBTCxDQUFhK0MsU0FBYixDQUF1QixLQUFLOUMsYUFBNUIsRUFBMkMsS0FBS0MsTUFBaEQsQ0FBUDtBQUNELENBRkQ7QUFHQThDLE9BQU9DLE9BQVAsR0FBaUJwRCxTQUFqQiIsImZpbGUiOiJUb2tlbml6ZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvL1Rva2VuaXplci5qc1xuZnVuY3Rpb24gVG9rZW5pemVyKGNicykge1xuICB0aGlzLl9zdGF0ZSA9IFwiVEVYVFwiO1xuICB0aGlzLl9idWZmZXIgPSBcIlwiO1xuICB0aGlzLl9zZWN0aW9uU3RhcnQgPSAwO1xuICB0aGlzLl9pbmRleCA9IDA7XG4gIHRoaXMuX2NicyA9IGNicztcbn1cblRva2VuaXplci5wcm90b3R5cGUuVEVYVCA9IGZ1bmN0aW9uKGMpIHtcbiAgdmFyIGluZGV4ID0gdGhpcy5fYnVmZmVyLmluZGV4T2YoXCI8XCIsIHRoaXMuX2luZGV4KTtcbiAgaWYgKGluZGV4ICE9IC0xKSB7XG4gICAgdGhpcy5faW5kZXggPSBpbmRleDtcbiAgICB0aGlzLl9jYnMub250ZXh0KHRoaXMuX2dldFNlY3Rpb24oKSk7XG4gICAgdGhpcy5fc3RhdGUgPSBcIkJlZm9yZVRhZ1wiO1xuICAgIHRoaXMuX3NlY3Rpb25TdGFydCA9IHRoaXMuX2luZGV4O1xuICB9IGVsc2UgdGhpcy5faW5kZXggPSB0aGlzLl9idWZmZXIubGVuZ3RoO1xufTtcblRva2VuaXplci5wcm90b3R5cGUuQmVmb3JlVGFnID0gZnVuY3Rpb24oYykge1xuICBzd2l0Y2ggKGMpIHtcbiAgICBjYXNlIFwiL1wiOlxuICAgICAgdGhpcy5fc3RhdGUgPSBcIkJlZm9yZUNsb3NlVGFnXCI7XG4gICAgICBicmVhaztcbiAgICBjYXNlIFwiIVwiOlxuICAgICAgdGhpcy5fc3RhdGUgPSBcIkJlZm9yZURlY2xhcmF0aW9uXCI7XG4gICAgICBicmVhaztcbiAgICBjYXNlIFwiP1wiOlxuICAgICAgbGV0IGluZGV4ID0gdGhpcy5fYnVmZmVyLmluZGV4T2YoXCI+XCIsIHRoaXMuX2luZGV4KTtcbiAgICAgIGlmIChpbmRleCAhPSAtMSkge1xuICAgICAgICB0aGlzLl9pbmRleCA9IGluZGV4O1xuICAgICAgICB0aGlzLl9zZWN0aW9uU3RhcnQgPSB0aGlzLl9pbmRleCArIDE7XG4gICAgICB9IGVsc2UgdGhpcy5fc2VjdGlvblN0YXJ0ID0gdGhpcy5faW5kZXggPSB0aGlzLl9idWZmZXIubGVuZ3RoO1xuICAgICAgdGhpcy5fc3RhdGUgPSBcIlRFWFRcIjtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgXCI+XCI6XG4gICAgICB0aGlzLl9zdGF0ZSA9IFwiVEVYVFwiO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSBcIjxcIjpcbiAgICAgIHRoaXMuX2Nicy5vbnRleHQodGhpcy5fZ2V0U2VjdGlvbigpKTtcbiAgICAgIHRoaXMuX3NlY3Rpb25TdGFydCA9IHRoaXMuX2luZGV4O1xuICAgICAgYnJlYWs7XG4gICAgZGVmYXVsdDpcbiAgICAgIGlmICgvXFxzLy50ZXN0KGMpKSB0aGlzLl9zdGF0ZSA9IFwiVEVYVFwiO1xuICAgICAgZWxzZSB7XG4gICAgICAgIHRoaXMuX3N0YXRlID0gXCJJblRhZ1wiO1xuICAgICAgICB0aGlzLl9zZWN0aW9uU3RhcnQgPSB0aGlzLl9pbmRleDtcbiAgICAgIH1cbiAgfVxufTtcblRva2VuaXplci5wcm90b3R5cGUuSW5UYWcgPSBmdW5jdGlvbihjKSB7XG4gIGlmIChjID09PSBcIi9cIiB8fCBjID09PSBcIj5cIiB8fCAvXFxzLy50ZXN0KGMpKSB7XG4gICAgdGhpcy5fY2JzLm9ub3BlbnRhZ25hbWUodGhpcy5fZ2V0U2VjdGlvbigpKTtcbiAgICB0aGlzLl9zdGF0ZSA9IFwiQmVmb3JlQXR0cnNOYW1lXCI7XG4gICAgdGhpcy5faW5kZXgtLTtcbiAgfVxufTtcblRva2VuaXplci5wcm90b3R5cGUuQmVmb3JlQXR0cnNOYW1lID0gZnVuY3Rpb24oYykge1xuICBpZiAoYyA9PT0gXCI+XCIpIHtcbiAgICB0aGlzLl9jYnMub25vcGVudGFnZW5kKCk7XG4gICAgdGhpcy5fc3RhdGUgPSBcIlRFWFRcIjtcbiAgICB0aGlzLl9zZWN0aW9uU3RhcnQgPSB0aGlzLl9pbmRleCArIDE7XG4gIH0gZWxzZSBpZiAoYyA9PT0gXCIvXCIpIHtcbiAgICB0aGlzLl9zdGF0ZSA9IFwiSW5TZWxmQ2xvc2VUYWdcIjtcbiAgfSBlbHNlIGlmICghKC9cXHMvLnRlc3QoYykpKSB7XG4gICAgdGhpcy5fc3RhdGUgPSBcIkluQXR0cnNOYW1lXCI7XG4gICAgdGhpcy5fc2VjdGlvblN0YXJ0ID0gdGhpcy5faW5kZXg7XG4gIH1cbn07XG5Ub2tlbml6ZXIucHJvdG90eXBlLkluQXR0cnNOYW1lID0gZnVuY3Rpb24oYykge1xuICBpZiAoYyA9PT0gXCI9XCIgfHwgYyA9PT0gXCIvXCIgfHwgYyA9PT0gXCI+XCIgfHwgL1xccy8udGVzdChjKSkge1xuICAgIHRoaXMuX2Nicy5fYXR0cmlibmFtZSA9IHRoaXMuX2dldFNlY3Rpb24oKS50b0xvd2VyQ2FzZSgpO1xuICAgIHRoaXMuX3NlY3Rpb25TdGFydCA9IC0xO1xuICAgIHRoaXMuX3N0YXRlID0gXCJBZnRlckF0dHJzTmFtZVwiO1xuICAgIHRoaXMuX2luZGV4LS07XG4gIH1cbn07XG5Ub2tlbml6ZXIucHJvdG90eXBlLkFmdGVyQXR0cnNOYW1lID0gZnVuY3Rpb24oYykge1xuICBpZiAoYyA9PT0gXCI9XCIpIHtcbiAgICB0aGlzLl9zdGF0ZSA9IFwiQmVmb3JlQXR0cnNWYWx1ZVwiO1xuICB9IGVsc2UgaWYgKGMgPT09IFwiL1wiIHx8IGMgPT09IFwiPlwiKSB7XG4gICAgdGhpcy5fY2JzLm9uYXR0cmliZW5kKCk7XG4gICAgdGhpcy5fc3RhdGUgPSBcIkJlZm9yZUF0dHJzTmFtZVwiO1xuICAgIHRoaXMuX2luZGV4LS07XG4gIH0gZWxzZSBpZiAoISgvXFxzLy50ZXN0KGMpKSkge1xuICAgIHRoaXMuX2Nicy5vbmF0dHJpYmVuZCgpO1xuICAgIHRoaXMuX3N0YXRlID0gXCJJbkF0dHJzTmFtZVwiO1xuICAgIHRoaXMuX3NlY3Rpb25TdGFydCA9IHRoaXMuX2luZGV4O1xuICB9XG59O1xuVG9rZW5pemVyLnByb3RvdHlwZS5CZWZvcmVBdHRyc1ZhbHVlID0gZnVuY3Rpb24oYykge1xuICBpZiAoYyA9PT0gJ1wiJykge1xuICAgIHRoaXMuX3N0YXRlID0gXCJJbkF0dHJzVmFsdWVEUVwiO1xuICAgIHRoaXMuX3NlY3Rpb25TdGFydCA9IHRoaXMuX2luZGV4ICsgMTtcbiAgfSBlbHNlIGlmIChjID09PSBcIidcIikge1xuICAgIHRoaXMuX3N0YXRlID0gXCJJbkF0dHJzVmFsdWVTUVwiO1xuICAgIHRoaXMuX3NlY3Rpb25TdGFydCA9IHRoaXMuX2luZGV4ICsgMTtcbiAgfSBlbHNlIGlmICghKC9cXHMvLnRlc3QoYykpKSB7XG4gICAgdGhpcy5fc3RhdGUgPSBcIkluQXR0cnNWYWx1ZU5RXCI7XG4gICAgdGhpcy5fc2VjdGlvblN0YXJ0ID0gdGhpcy5faW5kZXg7XG4gICAgdGhpcy5faW5kZXgtLTtcbiAgfVxufTtcblRva2VuaXplci5wcm90b3R5cGUuSW5BdHRyc1ZhbHVlRFEgPSBmdW5jdGlvbihjKSB7XG4gIGlmIChjID09PSAnXCInKSB7XG4gICAgdGhpcy5fY2JzLl9hdHRyaWJ2YWx1ZSArPSB0aGlzLl9nZXRTZWN0aW9uKCk7XG4gICAgdGhpcy5fY2JzLm9uYXR0cmliZW5kKCk7XG4gICAgdGhpcy5fc3RhdGUgPSBcIkJlZm9yZUF0dHJzTmFtZVwiO1xuICB9XG59O1xuVG9rZW5pemVyLnByb3RvdHlwZS5JbkF0dHJzVmFsdWVTUSA9IGZ1bmN0aW9uKGMpIHtcbiAgaWYgKGMgPT09IFwiJ1wiKSB7XG4gICAgdGhpcy5fY2JzLl9hdHRyaWJ2YWx1ZSArPSB0aGlzLl9nZXRTZWN0aW9uKCk7XG4gICAgdGhpcy5fY2JzLm9uYXR0cmliZW5kKCk7XG4gICAgdGhpcy5fc3RhdGUgPSBcIkJlZm9yZUF0dHJzTmFtZVwiO1xuICB9XG59O1xuVG9rZW5pemVyLnByb3RvdHlwZS5JbkF0dHJzVmFsdWVOUSA9IGZ1bmN0aW9uKGMpIHtcbiAgaWYgKC9cXHMvLnRlc3QoYykgfHwgYyA9PT0gXCI+XCIpIHtcbiAgICB0aGlzLl9jYnMuX2F0dHJpYnZhbHVlICs9IHRoaXMuX2dldFNlY3Rpb24oKTtcbiAgICB0aGlzLl9jYnMub25hdHRyaWJlbmQoKTtcbiAgICB0aGlzLl9zdGF0ZSA9IFwiQmVmb3JlQXR0cnNOYW1lXCI7XG4gICAgdGhpcy5faW5kZXgtLTtcbiAgfVxufTtcblRva2VuaXplci5wcm90b3R5cGUuQmVmb3JlQ2xvc2VUYWcgPSBmdW5jdGlvbihjKSB7XG4gIGlmICgvXFxzLy50ZXN0KGMpKTtcbiAgZWxzZSBpZiAoYyA9PT0gXCI+XCIpIHtcbiAgICB0aGlzLl9zdGF0ZSA9IFwiVEVYVFwiO1xuICB9IGVsc2Uge1xuICAgIHRoaXMuX3N0YXRlID0gXCJJbkNsb3NlVGFnXCI7XG4gICAgdGhpcy5fc2VjdGlvblN0YXJ0ID0gdGhpcy5faW5kZXg7XG4gIH1cbn07XG5Ub2tlbml6ZXIucHJvdG90eXBlLkluQ2xvc2VUYWcgPSBmdW5jdGlvbihjKSB7XG4gIGlmIChjID09PSBcIj5cIiB8fCAvXFxzLy50ZXN0KGMpKSB7XG4gICAgdGhpcy5fY2JzLm9uY2xvc2V0YWcodGhpcy5fZ2V0U2VjdGlvbigpKTtcbiAgICB0aGlzLl9zdGF0ZSA9IFwiQWZ0ZXJDbG9zZVRhZ1wiO1xuICAgIHRoaXMuX2luZGV4LS07XG4gIH1cbn07XG5Ub2tlbml6ZXIucHJvdG90eXBlLkluU2VsZkNsb3NlVGFnID0gZnVuY3Rpb24oYykge1xuICBpZiAoYyA9PT0gXCI+XCIpIHtcbiAgICB0aGlzLl9jYnMub25vcGVudGFnZW5kKCk7XG4gICAgdGhpcy5fc3RhdGUgPSBcIlRFWFRcIjtcbiAgICB0aGlzLl9zZWN0aW9uU3RhcnQgPSB0aGlzLl9pbmRleCArIDE7XG4gIH0gZWxzZSBpZiAoISgvXFxzLy50ZXN0KGMpKSkge1xuICAgIHRoaXMuX3N0YXRlID0gXCJCZWZvcmVBdHRyc05hbWVcIjtcbiAgICB0aGlzLl9pbmRleC0tO1xuICB9XG59O1xuVG9rZW5pemVyLnByb3RvdHlwZS5BZnRlckNsb3NlVGFnID0gZnVuY3Rpb24oYykge1xuICBpZiAoYyA9PT0gXCI+XCIpIHtcbiAgICB0aGlzLl9zdGF0ZSA9IFwiVEVYVFwiO1xuICAgIHRoaXMuX3NlY3Rpb25TdGFydCA9IHRoaXMuX2luZGV4ICsgMTtcbiAgfVxufTtcblRva2VuaXplci5wcm90b3R5cGUuQmVmb3JlRGVjbGFyYXRpb24gPSBmdW5jdGlvbihjKSB7XG4gIGlmIChjID09ICctJykgdGhpcy5fc3RhdGUgPSBcIkluQ29tbWVudFwiO1xuICBlbHNlIGlmIChjID09ICdbJykgdGhpcy5fc3RhdGUgPSBcIkJlZm9yZUNEQVRBMVwiO1xuICBlbHNlIHRoaXMuX3N0YXRlID0gXCJJbkRlY2xhcmF0aW9uXCI7XG59O1xuVG9rZW5pemVyLnByb3RvdHlwZS5JbkRlY2xhcmF0aW9uID0gZnVuY3Rpb24oYykge1xuICB2YXIgaW5kZXggPSB0aGlzLl9idWZmZXIuaW5kZXhPZihcIj5cIiwgdGhpcy5faW5kZXgpO1xuICBpZiAoaW5kZXggIT0gLTEpIHtcbiAgICB0aGlzLl9pbmRleCA9IGluZGV4O1xuICAgIHRoaXMuX3NlY3Rpb25TdGFydCA9IGluZGV4ICsgMTtcbiAgfSBlbHNlIHRoaXMuX3NlY3Rpb25TdGFydCA9IHRoaXMuX2luZGV4ID0gdGhpcy5fYnVmZmVyLmxlbmd0aDtcbiAgdGhpcy5fc3RhdGUgPSBcIlRFWFRcIjtcbn07XG5Ub2tlbml6ZXIucHJvdG90eXBlLkluQ29tbWVudCA9IGZ1bmN0aW9uKGMpIHtcbiAgbGV0IGtleSA9IChjID09ICctJyA/ICctLT4nIDogJz4nKTtcbiAgbGV0IGluZGV4ID0gdGhpcy5fYnVmZmVyLmluZGV4T2Yoa2V5LCB0aGlzLl9pbmRleCk7XG4gIGlmIChpbmRleCAhPSAtMSkge1xuICAgIHRoaXMuX2luZGV4ID0gaW5kZXggKyBrZXkubGVuZ3RoIC0gMTtcbiAgICB0aGlzLl9zZWN0aW9uU3RhcnQgPSB0aGlzLl9pbmRleCArIDE7XG4gIH0gZWxzZSB0aGlzLl9zZWN0aW9uU3RhcnQgPSB0aGlzLl9pbmRleCA9IHRoaXMuX2J1ZmZlci5sZW5ndGg7XG4gIHRoaXMuX3N0YXRlID0gXCJURVhUXCI7XG59O1xuVG9rZW5pemVyLnByb3RvdHlwZS5CZWZvcmVDREFUQTEgPSBmdW5jdGlvbihjKSB7XG4gIGlmIChjID09ICdDJykgdGhpcy5fc3RhdGUgPSBcIkJlZm9yZUNEQVRBMlwiO1xuICBlbHNlIHRoaXMuX3N0YXRlID0gXCJJbkRlY2xhcmF0aW9uXCI7XG59O1xuVG9rZW5pemVyLnByb3RvdHlwZS5CZWZvcmVDREFUQTIgPSBmdW5jdGlvbihjKSB7XG4gIGlmIChjID09ICdEJykgdGhpcy5fc3RhdGUgPSBcIkJlZm9yZUNEQVRBM1wiO1xuICBlbHNlIHRoaXMuX3N0YXRlID0gXCJJbkRlY2xhcmF0aW9uXCI7XG59O1xuVG9rZW5pemVyLnByb3RvdHlwZS5CZWZvcmVDREFUQTMgPSBmdW5jdGlvbihjKSB7XG4gIGlmIChjID09ICdBJykgdGhpcy5fc3RhdGUgPSBcIkJlZm9yZUNEQVRBNFwiO1xuICBlbHNlIHRoaXMuX3N0YXRlID0gXCJJbkRlY2xhcmF0aW9uXCI7XG59O1xuVG9rZW5pemVyLnByb3RvdHlwZS5CZWZvcmVDREFUQTQgPSBmdW5jdGlvbihjKSB7XG4gIGlmIChjID09ICdUJykgdGhpcy5fc3RhdGUgPSBcIkJlZm9yZUNEQVRBNVwiO1xuICBlbHNlIHRoaXMuX3N0YXRlID0gXCJJbkRlY2xhcmF0aW9uXCI7XG59O1xuVG9rZW5pemVyLnByb3RvdHlwZS5CZWZvcmVDREFUQTUgPSBmdW5jdGlvbihjKSB7XG4gIGlmIChjID09ICdBJykgdGhpcy5fc3RhdGUgPSBcIkluQ0RBVEFcIjtcbiAgZWxzZSB0aGlzLl9zdGF0ZSA9IFwiSW5EZWNsYXJhdGlvblwiO1xufTtcblRva2VuaXplci5wcm90b3R5cGUuSW5DREFUQSA9IGZ1bmN0aW9uKGMpIHtcbiAgbGV0IGtleSA9IChjID09ICdbJyA/ICddXT4nIDogJz4nKTtcbiAgbGV0IGluZGV4ID0gdGhpcy5fYnVmZmVyLmluZGV4T2Yoa2V5LCB0aGlzLl9pbmRleCk7XG4gIGlmIChpbmRleCAhPSAtMSkge1xuICAgIHRoaXMuX2luZGV4ID0gaW5kZXggKyBrZXkubGVuZ3RoIC0gMTtcbiAgICB0aGlzLl9zZWN0aW9uU3RhcnQgPSB0aGlzLl9pbmRleCArIDE7XG4gIH0gZWxzZSB0aGlzLl9zZWN0aW9uU3RhcnQgPSB0aGlzLl9pbmRleCA9IHRoaXMuX2J1ZmZlci5sZW5ndGg7XG4gIHRoaXMuX3N0YXRlID0gXCJURVhUXCI7XG59O1xuVG9rZW5pemVyLnByb3RvdHlwZS5wYXJzZSA9IGZ1bmN0aW9uKGNodW5rKSB7XG4gIHRoaXMuX2J1ZmZlciArPSBjaHVuaztcbiAgZm9yICg7IHRoaXMuX2luZGV4IDwgdGhpcy5fYnVmZmVyLmxlbmd0aDsgdGhpcy5faW5kZXgrKylcbiAgICB0aGlzW3RoaXMuX3N0YXRlXSh0aGlzLl9idWZmZXJbdGhpcy5faW5kZXhdKTtcbiAgaWYgKHRoaXMuX3N0YXRlID09PSBcIlRFWFRcIiAmJiB0aGlzLl9zZWN0aW9uU3RhcnQgIT09IHRoaXMuX2luZGV4KVxuICAgIHRoaXMuX2Nicy5vbnRleHQodGhpcy5fYnVmZmVyLnN1YnN0cih0aGlzLl9zZWN0aW9uU3RhcnQpKTtcbiAgdGhpcy5fY2JzLm9uZW5kKCk7XG59O1xuVG9rZW5pemVyLnByb3RvdHlwZS5fZ2V0U2VjdGlvbiA9IGZ1bmN0aW9uKCkge1xuICByZXR1cm4gdGhpcy5fYnVmZmVyLnN1YnN0cmluZyh0aGlzLl9zZWN0aW9uU3RhcnQsIHRoaXMuX2luZGV4KTtcbn07XG5tb2R1bGUuZXhwb3J0cyA9IFRva2VuaXplcjsiXX0=