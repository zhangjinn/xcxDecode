'use strict';

//DomHandler.js
var CssTokenizer = require('./CssTokenizer.js');
var CanIUse = require('./api.js').versionHigherThan('2.7.1');
var Common = 1,
    Rich = 2;
var trustTag = {
  a: Rich,
  abbr: Common,
  audio: Rich,
  b: Common,
  blockquote: Common,
  br: Rich,
  code: Common,
  col: Rich,
  colgroup: Rich,
  dd: Common,
  del: Common,
  dl: Common,
  dt: Common,
  div: Common,
  em: Common,
  fieldset: Rich,
  font: Common,
  h1: Rich,
  h2: Rich,
  h3: Rich,
  h4: Rich,
  h5: Rich,
  h6: Rich,
  hr: Rich,
  i: Common,
  img: Common,
  ins: Common,
  label: Common,
  legend: Rich,
  li: Rich,
  ol: Rich,
  p: Common,
  q: Common,
  source: Rich,
  span: Common,
  strong: Common,
  sub: Rich,
  sup: Rich,
  table: Rich,
  tbody: Rich,
  td: Rich,
  tfoot: Rich,
  th: Rich,
  thead: Rich,
  tr: Rich,
  u: Common,
  ul: Rich,
  video: Common
};
var blockTag = {
  address: true,
  article: true,
  aside: true,
  body: true,
  center: true,
  cite: true,
  footer: true,
  header: true,
  html: true,
  nav: true,
  pre: true,
  section: true
};
var textTag = {
  a: true,
  abbr: true,
  b: true,
  big: true,
  code: true,
  del: true,
  em: true,
  font: true,
  i: true,
  ins: true,
  label: true,
  mark: true,
  q: true,
  s: true,
  small: true,
  span: true,
  strong: true,
  u: true
};
var ignoreTag = {
  area: true,
  base: true,
  basefont: true,
  canvas: true,
  circle: true,
  command: true,
  ellipse: true,
  embed: true,
  frame: true,
  head: true,
  iframe: true,
  input: true,
  isindex: true,
  keygen: true,
  line: true,
  link: true,
  map: true,
  meta: true,
  param: true,
  path: true,
  polygon: true,
  polyline: true,
  rect: true,
  script: true,
  stop: true,
  textarea: true,
  title: true,
  track: true,
  use: true,
  wbr: true
};
if (CanIUse) {
  trustTag.bdi = Rich;
  trustTag.bdo = Rich;
  trustTag.caption = Rich;
  trustTag.rt = Rich;
  trustTag.ruby = Rich;
  ignoreTag.rp = true;
  trustTag.big = Common;
  trustTag.small = Common;
  trustTag.pre = Rich;
  delete blockTag.pre;
}
//添加默认值
function initStyle(tagStyle) {
  tagStyle.a = "display:inline;color:#366092;word-break:break-all;" + (tagStyle.a || "");
  tagStyle.address = "font-style:italic;" + (tagStyle.address || "");
  tagStyle.blockquote = tagStyle.blockquote || 'background-color:#f6f6f6;border-left:3px solid #dbdbdb;color:#6c6c6c;padding:5px 0 5px 10px';
  tagStyle.center = 'text-align:center;' + (tagStyle.center || "");
  tagStyle.cite = "font-style:italic;" + (tagStyle.cite || "");
  tagStyle.code = tagStyle.code || 'padding:0 1px 0 1px;margin-left:2px;margin-right:2px;background-color:#f8f8f8;border:1px solid #cccccc;border-radius:3px';
  tagStyle.dd = "margin-left:40px;" + (tagStyle.dd || "");
  tagStyle.img = "max-width:100%;" + (tagStyle.img || "");
  tagStyle.mark = "display:inline;background-color:yellow;" + (tagStyle.mark || "");
  tagStyle.pre = "overflow:scroll;" + (tagStyle.pre || 'background-color:#f6f8fa;padding:5px;border-radius:5px;');
  tagStyle.s = "display:inline;text-decoration:line-through;" + (tagStyle.s || "");
  tagStyle.u = "display:inline;text-decoration:underline;" + (tagStyle.u || "");
  //低版本兼容
  if (!CanIUse) {
    blockTag.caption = true;
    tagStyle.big = "display:inline;font-size:1.2em;" + (tagStyle.big || "");
    tagStyle.small = "display:inline;font-size:0.8em;" + (tagStyle.small || "");
    tagStyle.pre = "font-family:monospace;white-space:pre;" + tagStyle.pre;
  }
  return tagStyle;
}

function DomHandler(style) {
  var tagStyle = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

  this.imgList = [];
  this.nodes = [];
  this.title = "";
  this._videoNum = 0;
  this._audioNum = 0;
  this._style = new CssTokenizer(style, initStyle(tagStyle)).parse();
  this._tagStack = [];
}
DomHandler.prototype._addDomElement = function (element) {
  var parent = this._tagStack[this._tagStack.length - 1];
  var siblings = parent ? parent.children : this.nodes;
  siblings.push(element);
};
DomHandler.prototype._bubbling = function () {
  for (var i = this._tagStack.length - 1; i >= 0; i--) {
    if (trustTag[this._tagStack[i].name] == Common) this._tagStack[i].continue = true;else return this._tagStack[i].name;
  }
};
DomHandler.prototype.onopentag = function (name, attrs) {
  var element = {
    children: []
  };
  //匹配样式
  var matched = this._style[name] ? this._style[name] + ';' : '';
  if (attrs.id) {
    matched += this._style['#' + attrs.id] ? this._style['#' + attrs.id] + ';' : '';
    delete attrs.id;
  }
  if (attrs.class) {
    var _iteratorNormalCompletion = true;
    var _didIteratorError = false;
    var _iteratorError = undefined;

    try {
      for (var _iterator = attrs.class.split(' ')[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
        var Class = _step.value;

        matched += this._style['.' + Class] ? this._style['.' + Class] + ';' : '';
      }
    } catch (err) {
      _didIteratorError = true;
      _iteratorError = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion && _iterator.return) {
          _iterator.return();
        }
      } finally {
        if (_didIteratorError) {
          throw _iteratorError;
        }
      }
    }

    delete attrs.class;
  }
  //处理属性
  switch (name) {
    case 'div':
    case 'p':
      if (attrs.align) {
        attrs.style += ';text-align:' + attrs.align;
        delete attrs.align;
      }
      break;
    case 'img':
      if (attrs.width) {
        attrs.style = 'width:' + attrs.width + (/[0-9]/.test(attrs.width[attrs.width.length - 1]) ? 'px' : '') + ';' + attrs.style;
        delete attrs.width;
      }
      if (attrs['data-src']) {
        attrs.src = attrs.src || attrs['data-src'];
        delete attrs['data-src'];
      }
      if (!attrs.hasOwnProperty('ignore') && attrs.src) {
        this.imgList.push(attrs.src);
        if (this._bubbling() == 'a') attrs.ignore = "";
      };
      break;
    case 'font':
      name = 'span';
      if (attrs.color) {
        attrs.style += ';color:' + attrs.color;
        delete attrs.color;
      }
      if (attrs.face) {
        attrs.style += ";font-family:" + attrs.face;
        delete attrs.face;
      }
      if (attrs.size) {
        var size = parseInt(attrs.size);
        if (size < 1) size = 1;else if (size > 7) size = 7;
        switch (size) {
          case 1:
            size = 10;
            break;
          case 2:
            size = 13;
            break;
          case 3:
            size = 16;
            break;
          case 4:
            size = 18;
            break;
          case 5:
            size = 24;
            break;
          case 6:
            size = 32;
            break;
          case 7:
            size = 48;
            break;
        }
        attrs.style += ";font-size:" + size + "px";
        delete attrs.size;
      }
      break;
    case 'a':
      this._bubbling();
      break;
    case 'video':
    case 'audio':
      attrs.loop = attrs.hasOwnProperty('loop');
      attrs.controls = attrs.hasOwnProperty('controls');
      attrs.autoplay = attrs.hasOwnProperty('autoplay');
      if (name == 'video') {
        attrs.muted = attrs.hasOwnProperty('muted');
        if (attrs.width) {
          attrs.style = 'width:' + parseFloat(attrs.width) + 'px;' + attrs.style;
          delete attrs.width;
        }
        if (attrs.height) {
          attrs.style = 'height:' + parseFloat(attrs.height) + 'px;' + attrs.style;
          delete attrs.height;
        }
      }
      attrs.id = name + ++this['_' + name + 'Num'];
      attrs.source = [];
      if (attrs.src) attrs.source.push(attrs.src);
      if (!attrs.controls && !attrs.autoplay) console.warn('存在没有controls属性的' + name + '标签，可能导致无法播放', attrs);
      this._bubbling();
      break;
    case 'source':
      var parent = this._tagStack[this._tagStack.length - 1];
      if (parent && (parent.name == 'video' || parent.name == 'audio')) {
        parent.attrs.source.push(attrs.src);
        if (!parent.attrs.src) parent.attrs.src = attrs.src;
      }
      this._tagStack.push(element);
      return;
  }
  attrs.style = matched + attrs.style;
  if (textTag[name]) element.continue = true;else if (blockTag[name]) name = 'div';else if (!trustTag[name]) name = 'span';
  element.name = name;
  element.attrs = attrs;
  this._addDomElement(element);
  this._tagStack.push(element);
};
DomHandler.prototype.ontext = function (data) {
  if (/\S/.test(data)) {
    var element = {
      text: data.replace(/&nbsp;/g, '\xA0'),
      type: 'text'
    };
    if (/&#*((?!sp|lt|gt).){2,5};/.test(data)) element.decode = true;
    this._addDomElement(element);
  }
};
DomHandler.prototype.onclosetag = function (name) {
  var element = this._tagStack.pop();
  if (ignoreTag[name]) {
    if (name == 'title') {
      try {
        this.title = element.children[0].text;
      } catch (e) {}
    }
    var parent = this._tagStack[this._tagStack.length - 1];
    var siblings = parent ? parent.children : this.nodes;
    siblings.pop();
  }
};
module.exports = DomHandler;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkRvbUhhbmRsZXIuanMiXSwibmFtZXMiOlsiQ3NzVG9rZW5pemVyIiwicmVxdWlyZSIsIkNhbklVc2UiLCJ2ZXJzaW9uSGlnaGVyVGhhbiIsIkNvbW1vbiIsIlJpY2giLCJ0cnVzdFRhZyIsImEiLCJhYmJyIiwiYXVkaW8iLCJiIiwiYmxvY2txdW90ZSIsImJyIiwiY29kZSIsImNvbCIsImNvbGdyb3VwIiwiZGQiLCJkZWwiLCJkbCIsImR0IiwiZGl2IiwiZW0iLCJmaWVsZHNldCIsImZvbnQiLCJoMSIsImgyIiwiaDMiLCJoNCIsImg1IiwiaDYiLCJociIsImkiLCJpbWciLCJpbnMiLCJsYWJlbCIsImxlZ2VuZCIsImxpIiwib2wiLCJwIiwicSIsInNvdXJjZSIsInNwYW4iLCJzdHJvbmciLCJzdWIiLCJzdXAiLCJ0YWJsZSIsInRib2R5IiwidGQiLCJ0Zm9vdCIsInRoIiwidGhlYWQiLCJ0ciIsInUiLCJ1bCIsInZpZGVvIiwiYmxvY2tUYWciLCJhZGRyZXNzIiwiYXJ0aWNsZSIsImFzaWRlIiwiYm9keSIsImNlbnRlciIsImNpdGUiLCJmb290ZXIiLCJoZWFkZXIiLCJodG1sIiwibmF2IiwicHJlIiwic2VjdGlvbiIsInRleHRUYWciLCJiaWciLCJtYXJrIiwicyIsInNtYWxsIiwiaWdub3JlVGFnIiwiYXJlYSIsImJhc2UiLCJiYXNlZm9udCIsImNhbnZhcyIsImNpcmNsZSIsImNvbW1hbmQiLCJlbGxpcHNlIiwiZW1iZWQiLCJmcmFtZSIsImhlYWQiLCJpZnJhbWUiLCJpbnB1dCIsImlzaW5kZXgiLCJrZXlnZW4iLCJsaW5lIiwibGluayIsIm1hcCIsIm1ldGEiLCJwYXJhbSIsInBhdGgiLCJwb2x5Z29uIiwicG9seWxpbmUiLCJyZWN0Iiwic2NyaXB0Iiwic3RvcCIsInRleHRhcmVhIiwidGl0bGUiLCJ0cmFjayIsInVzZSIsIndiciIsImJkaSIsImJkbyIsImNhcHRpb24iLCJydCIsInJ1YnkiLCJycCIsImluaXRTdHlsZSIsInRhZ1N0eWxlIiwiRG9tSGFuZGxlciIsInN0eWxlIiwiaW1nTGlzdCIsIm5vZGVzIiwiX3ZpZGVvTnVtIiwiX2F1ZGlvTnVtIiwiX3N0eWxlIiwicGFyc2UiLCJfdGFnU3RhY2siLCJwcm90b3R5cGUiLCJfYWRkRG9tRWxlbWVudCIsImVsZW1lbnQiLCJwYXJlbnQiLCJsZW5ndGgiLCJzaWJsaW5ncyIsImNoaWxkcmVuIiwicHVzaCIsIl9idWJibGluZyIsIm5hbWUiLCJjb250aW51ZSIsIm9ub3BlbnRhZyIsImF0dHJzIiwibWF0Y2hlZCIsImlkIiwiY2xhc3MiLCJzcGxpdCIsIkNsYXNzIiwiYWxpZ24iLCJ3aWR0aCIsInRlc3QiLCJzcmMiLCJoYXNPd25Qcm9wZXJ0eSIsImlnbm9yZSIsImNvbG9yIiwiZmFjZSIsInNpemUiLCJwYXJzZUludCIsImxvb3AiLCJjb250cm9scyIsImF1dG9wbGF5IiwibXV0ZWQiLCJwYXJzZUZsb2F0IiwiaGVpZ2h0IiwiY29uc29sZSIsIndhcm4iLCJvbnRleHQiLCJkYXRhIiwidGV4dCIsInJlcGxhY2UiLCJ0eXBlIiwiZGVjb2RlIiwib25jbG9zZXRhZyIsInBvcCIsImUiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOztBQUFBO0FBQ0EsSUFBTUEsZUFBZUMsUUFBUSxtQkFBUixDQUFyQjtBQUNBLElBQU1DLFVBQVVELFFBQVEsVUFBUixFQUFvQkUsaUJBQXBCLENBQXNDLE9BQXRDLENBQWhCO0FBQ0EsSUFBTUMsU0FBUyxDQUFmO0FBQUEsSUFDRUMsT0FBTyxDQURUO0FBRUEsSUFBTUMsV0FBVztBQUNmQyxLQUFHRixJQURZO0FBRWZHLFFBQU1KLE1BRlM7QUFHZkssU0FBT0osSUFIUTtBQUlmSyxLQUFHTixNQUpZO0FBS2ZPLGNBQVlQLE1BTEc7QUFNZlEsTUFBSVAsSUFOVztBQU9mUSxRQUFNVCxNQVBTO0FBUWZVLE9BQUtULElBUlU7QUFTZlUsWUFBVVYsSUFUSztBQVVmVyxNQUFJWixNQVZXO0FBV2ZhLE9BQUtiLE1BWFU7QUFZZmMsTUFBSWQsTUFaVztBQWFm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aEMsQ0FBSixFQUEyQ25DLFFBQVF1QyxNQUFSLEdBQWlCLElBQWpCO0FBQzNDLFNBQUt4QyxjQUFMLENBQW9CQyxPQUFwQjtBQUNEO0FBQ0YsQ0FURDtBQVVBWCxXQUFXUyxTQUFYLENBQXFCMEMsVUFBckIsR0FBa0MsVUFBU2pDLElBQVQsRUFBZTtBQUMvQyxNQUFJUCxVQUFVLEtBQUtILFNBQUwsQ0FBZTRDLEdBQWYsRUFBZDtBQUNBLE1BQUkzRixVQUFVeUQsSUFBVixDQUFKLEVBQXFCO0FBQ25CLFFBQUlBLFFBQVEsT0FBWixFQUFxQjtBQUNuQixVQUFJO0FBQ0YsYUFBSzlCLEtBQUwsR0FBYXVCLFFBQVFJLFFBQVIsQ0FBaUIsQ0FBakIsRUFBb0JnQyxJQUFqQztBQUNELE9BRkQsQ0FFRSxPQUFPTSxDQUFQLEVBQVUsQ0FBRTtBQUNmO0FBQ0QsUUFBSXpDLFNBQVMsS0FBS0osU0FBTCxDQUFlLEtBQUtBLFNBQUwsQ0FBZUssTUFBZixHQUF3QixDQUF2QyxDQUFiO0FBQ0EsUUFBSUMsV0FBV0YsU0FBU0EsT0FBT0csUUFBaEIsR0FBMkIsS0FBS1osS0FBL0M7QUFDQVcsYUFBU3NDLEdBQVQ7QUFDRDtBQUNGLENBWkQ7QUFhQUUsT0FBT0MsT0FBUCxHQUFpQnZELFVBQWpCIiwiZmlsZSI6IkRvbUhhbmRsZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvL0RvbUhhbmRsZXIuanNcbmNvbnN0IENzc1Rva2VuaXplciA9IHJlcXVpcmUoJy4vQ3NzVG9rZW5pemVyLmpzJyk7XG5jb25zdCBDYW5JVXNlID0gcmVxdWlyZSgnLi9hcGkuanMnKS52ZXJzaW9uSGlnaGVyVGhhbignMi43LjEnKTtcbmNvbnN0IENvbW1vbiA9IDEsXG4gIFJpY2ggPSAyO1xuY29uc3QgdHJ1c3RUYWcgPSB7XG4gIGE6IFJpY2gsXG4gIGFiYnI6IENvbW1vbixcbiAgYXVkaW86IFJpY2gsXG4gIGI6IENvbW1vbixcbiAgYmxvY2txdW90ZTogQ29tbW9uLFxuICBicjogUmljaCxcbiAgY29kZTogQ29tbW9uLFxuICBjb2w6IFJpY2gsXG4gIGNvbGdyb3VwOiBSaWNoLFxuICBkZDogQ29tbW9uLFxuICBkZWw6IENvbW1vbixcbiAgZGw6IENvbW1vbixcbiAgZHQ6IENvbW1vbixcbiAgZGl2OiBDb21tb24sXG4gIGVtOiBDb21tb24sXG4gIGZpZWxkc2V0OiBSaWNoLFxuICBmb250OiBDb21tb24sXG4gIGgxOiBSaWNoLFxuICBoMjogUmljaCxcbiAgaDM6IFJpY2gsXG4gIGg0OiBSaWNoLFxuICBoNTogUmljaCxcbiAgaDY6IFJpY2gsXG4gIGhyOiBSaWNoLFxuICBpOiBDb21tb24sXG4gIGltZzogQ29tbW9uLFxuICBpbnM6IENvbW1vbixcbiAgbGFiZWw6IENvbW1vbixcbiAgbGVnZW5kOiBSaWNoLFxuICBsaTogUmljaCxcbiAgb2w6IFJpY2gsXG4gIHA6IENvbW1vbixcbiAgcTogQ29tbW9uLFxuICBzb3VyY2U6IFJpY2gsXG4gIHNwYW46IENvbW1vbixcbiAgc3Ryb25nOiBDb21tb24sXG4gIHN1YjogUmljaCxcbiAgc3VwOiBSaWNoLFxuICB0YWJsZTogUmljaCxcbiAgdGJvZHk6IFJpY2gsXG4gIHRkOiBSaWNoLFxuICB0Zm9vdDogUmljaCxcbiAgdGg6IFJpY2gsXG4gIHRoZWFkOiBSaWNoLFxuICB0cjogUmljaCxcbiAgdTogQ29tbW9uLFxuICB1bDogUmljaCxcbiAgdmlkZW86IENvbW1vblxufTtcbmNvbnN0IGJsb2NrVGFnID0ge1xuICBhZGRyZXNzOiB0cnVlLFxuICBhcnRpY2xlOiB0cnVlLFxuICBhc2lkZTogdHJ1ZSxcbiAgYm9keTogdHJ1ZSxcbiAgY2VudGVyOiB0cnVlLFxuICBjaXRlOiB0cnVlLFxuICBmb290ZXI6IHRydWUsXG4gIGhlYWRlcjogdHJ1ZSxcbiAgaHRtbDogdHJ1ZSxcbiAgbmF2OiB0cnVlLFxuICBwcmU6IHRydWUsXG4gIHNlY3Rpb246IHRydWVcbn1cbmNvbnN0IHRleHRUYWcgPSB7XG4gIGE6IHRydWUsXG4gIGFiYnI6IHRydWUsXG4gIGI6IHRydWUsXG4gIGJpZzogdHJ1ZSxcbiAgY29kZTogdHJ1ZSxcbiAgZGVsOiB0cnVlLFxuICBlbTogdHJ1ZSxcbiAgZm9udDogdHJ1ZSxcbiAgaTogdHJ1ZSxcbiAgaW5zOiB0cnVlLFxuICBsYWJlbDogdHJ1ZSxcbiAgbWFyazogdHJ1ZSxcbiAgcTogdHJ1ZSxcbiAgczogdHJ1ZSxcbiAgc21hbGw6IHRydWUsXG4gIHNwYW46IHRydWUsXG4gIHN0cm9uZzogdHJ1ZSxcbiAgdTogdHJ1ZVxufTtcbmNvbnN0IGlnbm9yZVRhZyA9IHtcbiAgYXJlYTogdHJ1ZSxcbiAgYmFzZTogdHJ1ZSxcbiAgYmFzZWZvbnQ6IHRydWUsXG4gIGNhbnZhczogdHJ1ZSxcbiAgY2lyY2xlOiB0cnVlLFxuICBjb21tYW5kOiB0cnVlLFxuICBlbGxpcHNlOiB0cnVlLFxuICBlbWJlZDogdHJ1ZSxcbiAgZnJhbWU6IHRydWUsXG4gIGhlYWQ6IHRydWUsXG4gIGlmcmFtZTogdHJ1ZSxcbiAgaW5wdXQ6IHRydWUsXG4gIGlzaW5kZXg6IHRydWUsXG4gIGtleWdlbjogdHJ1ZSxcbiAgbGluZTogdHJ1ZSxcbiAgbGluazogdHJ1ZSxcbiAgbWFwOiB0cnVlLFxuICBtZXRhOiB0cnVlLFxuICBwYXJhbTogdHJ1ZSxcbiAgcGF0aDogdHJ1ZSxcbiAgcG9seWdvbjogdHJ1ZSxcbiAgcG9seWxpbmU6IHRydWUsXG4gIHJlY3Q6IHRydWUsXG4gIHNjcmlwdDogdHJ1ZSxcbiAgc3RvcDogdHJ1ZSxcbiAgdGV4dGFyZWE6IHRydWUsXG4gIHRpdGxlOiB0cnVlLFxuICB0cmFjazogdHJ1ZSxcbiAgdXNlOiB0cnVlLFxuICB3YnI6IHRydWVcbn07XG5pZiAoQ2FuSVVzZSkge1xuICB0cnVzdFRhZy5iZGkgPSBSaWNoO1xuICB0cnVzdFRhZy5iZG8gPSBSaWNoO1xuICB0cnVzdFRhZy5jYXB0aW9uID0gUmljaDtcbiAgdHJ1c3RUYWcucnQgPSBSaWNoO1xuICB0cnVzdFRhZy5ydWJ5ID0gUmljaDtcbiAgaWdub3JlVGFnLnJwID0gdHJ1ZTtcbiAgdHJ1c3RUYWcuYmlnID0gQ29tbW9uO1xuICB0cnVzdFRhZy5zbWFsbCA9IENvbW1vbjtcbiAgdHJ1c3RUYWcucHJlID0gUmljaDtcbiAgZGVsZXRlIGJsb2NrVGFnLnByZTtcbn1cbi8v5re75Yqg6buY6K6k5YC8XG5mdW5jdGlvbiBpbml0U3R5bGUodGFnU3R5bGUpIHtcbiAgdGFnU3R5bGUuYSA9IFwiZGlzcGxheTppbmxpbmU7Y29sb3I6IzM2NjA5Mjt3b3JkLWJyZWFrOmJyZWFrLWFsbDtcIiArICh0YWdTdHlsZS5hIHx8IFwiXCIpO1xuICB0YWdTdHlsZS5hZGRyZXNzID0gXCJmb250LXN0eWxlOml0YWxpYztcIiArICh0YWdTdHlsZS5hZGRyZXNzIHx8IFwiXCIpO1xuICB0YWdTdHlsZS5ibG9ja3F1b3RlID0gdGFnU3R5bGUuYmxvY2txdW90ZSB8fCAnYmFja2dyb3VuZC1jb2xvcjojZjZmNmY2O2JvcmRlci1sZWZ0OjNweCBzb2xpZCAjZGJkYmRiO2NvbG9yOiM2YzZjNmM7cGFkZGluZzo1cHggMCA1cHggMTBweCc7XG4gIHRhZ1N0eWxlLmNlbnRlciA9ICd0ZXh0LWFsaWduOmNlbnRlcjsnICsgKHRhZ1N0eWxlLmNlbnRlciB8fCBcIlwiKTtcbiAgdGFnU3R5bGUuY2l0ZSA9IFwiZm9udC1zdHlsZTppdGFsaWM7XCIgKyAodGFnU3R5bGUuY2l0ZSB8fCBcIlwiKTtcbiAgdGFnU3R5bGUuY29kZSA9IHRhZ1N0eWxlLmNvZGUgfHwgJ3BhZGRpbmc6MCAxcHggMCAxcHg7bWFyZ2luLWxlZnQ6MnB4O21hcmdpbi1yaWdodDoycHg7YmFja2dyb3VuZC1jb2xvcjojZjhmOGY4O2JvcmRlcjoxcHggc29saWQgI2NjY2NjYztib3JkZXItcmFkaXVzOjNweCc7XG4gIHRhZ1N0eWxlLmRkID0gXCJtYXJnaW4tbGVmdDo0MHB4O1wiICsgKHRhZ1N0eWxlLmRkIHx8IFwiXCIpO1xuICB0YWdTdHlsZS5pbWcgPSBcIm1heC13aWR0aDoxMDAlO1wiICsgKHRhZ1N0eWxlLmltZyB8fCBcIlwiKTtcbiAgdGFnU3R5bGUubWFyayA9IFwiZGlzcGxheTppbmxpbmU7YmFja2dyb3VuZC1jb2xvcjp5ZWxsb3c7XCIgKyAodGFnU3R5bGUubWFyayB8fCBcIlwiKTtcbiAgdGFnU3R5bGUucHJlID0gXCJvdmVyZmxvdzpzY3JvbGw7XCIgKyAodGFnU3R5bGUucHJlIHx8ICdiYWNrZ3JvdW5kLWNvbG9yOiNmNmY4ZmE7cGFkZGluZzo1cHg7Ym9yZGVyLXJhZGl1czo1cHg7Jyk7XG4gIHRhZ1N0eWxlLnMgPSBcImRpc3BsYXk6aW5saW5lO3RleHQtZGVjb3JhdGlvbjpsaW5lLXRocm91Z2g7XCIgKyAodGFnU3R5bGUucyB8fCBcIlwiKTtcbiAgdGFnU3R5bGUudSA9IFwiZGlzcGxheTppbmxpbmU7dGV4dC1kZWNvcmF0aW9uOnVuZGVybGluZTtcIiArICh0YWdTdHlsZS51IHx8IFwiXCIpO1xuICAvL+S9jueJiOacrOWFvOWuuVxuICBpZiAoIUNhbklVc2UpIHtcbiAgICBibG9ja1RhZy5jYXB0aW9uID0gdHJ1ZTtcbiAgICB0YWdTdHlsZS5iaWcgPSBcImRpc3BsYXk6aW5saW5lO2ZvbnQtc2l6ZToxLjJlbTtcIiArICh0YWdTdHlsZS5iaWcgfHwgXCJcIik7XG4gICAgdGFnU3R5bGUuc21hbGwgPSBcImRpc3BsYXk6aW5saW5lO2ZvbnQtc2l6ZTowLjhlbTtcIiArICh0YWdTdHlsZS5zbWFsbCB8fCBcIlwiKTtcbiAgICB0YWdTdHlsZS5wcmUgPSBcImZvbnQtZmFtaWx5Om1vbm9zcGFjZTt3aGl0ZS1zcGFjZTpwcmU7XCIgKyB0YWdTdHlsZS5wcmU7XG4gIH1cbiAgcmV0dXJuIHRhZ1N0eWxlO1xufVxuXG5mdW5jdGlvbiBEb21IYW5kbGVyKHN0eWxlLCB0YWdTdHlsZSA9IHt9KSB7XG4gIHRoaXMuaW1nTGlzdCA9IFtdO1xuICB0aGlzLm5vZGVzID0gW107XG4gIHRoaXMudGl0bGUgPSBcIlwiO1xuICB0aGlzLl92aWRlb051bSA9IDA7XG4gIHRoaXMuX2F1ZGlvTnVtID0gMDtcbiAgdGhpcy5fc3R5bGUgPSBuZXcgQ3NzVG9rZW5pemVyKHN0eWxlLCBpbml0U3R5bGUodGFnU3R5bGUpKS5wYXJzZSgpO1xuICB0aGlzLl90YWdTdGFjayA9IFtdO1xufVxuRG9tSGFuZGxlci5wcm90b3R5cGUuX2FkZERvbUVsZW1lbnQgPSBmdW5jdGlvbihlbGVtZW50KSB7XG4gIGxldCBwYXJlbnQgPSB0aGlzLl90YWdTdGFja1t0aGlzLl90YWdTdGFjay5sZW5ndGggLSAxXTtcbiAgbGV0IHNpYmxpbmdzID0gcGFyZW50ID8gcGFyZW50LmNoaWxkcmVuIDogdGhpcy5ub2RlcztcbiAgc2libGluZ3MucHVzaChlbGVtZW50KTtcbn07XG5Eb21IYW5kbGVyLnByb3RvdHlwZS5fYnViYmxpbmcgPSBmdW5jdGlvbigpIHtcbiAgZm9yIChsZXQgaSA9IHRoaXMuX3RhZ1N0YWNrLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgaWYgKHRydXN0VGFnW3RoaXMuX3RhZ1N0YWNrW2ldLm5hbWVdID09IENvbW1vbikgdGhpcy5fdGFnU3RhY2tbaV0uY29udGludWUgPSB0cnVlO1xuICAgIGVsc2UgcmV0dXJuIHRoaXMuX3RhZ1N0YWNrW2ldLm5hbWU7XG4gIH1cbn1cbkRvbUhhbmRsZXIucHJvdG90eXBlLm9ub3BlbnRhZyA9IGZ1bmN0aW9uKG5hbWUsIGF0dHJzKSB7XG4gIGxldCBlbGVtZW50ID0ge1xuICAgIGNoaWxkcmVuOiBbXVxuICB9O1xuICAvL+WMuemFjeagt+W8j1xuICBsZXQgbWF0Y2hlZCA9IHRoaXMuX3N0eWxlW25hbWVdID8gKHRoaXMuX3N0eWxlW25hbWVdICsgJzsnKSA6ICcnO1xuICBpZiAoYXR0cnMuaWQpIHtcbiAgICBtYXRjaGVkICs9ICh0aGlzLl9zdHlsZVsnIycgKyBhdHRycy5pZF0gPyAodGhpcy5fc3R5bGVbJyMnICsgYXR0cnMuaWRdICsgJzsnKSA6ICcnKTtcbiAgICBkZWxldGUgYXR0cnMuaWQ7XG4gIH1cbiAgaWYgKGF0dHJzLmNsYXNzKSB7XG4gICAgZm9yICh2YXIgQ2xhc3Mgb2YgYXR0cnMuY2xhc3Muc3BsaXQoJyAnKSkge1xuICAgICAgbWF0Y2hlZCArPSAodGhpcy5fc3R5bGVbJy4nICsgQ2xhc3NdID8gKHRoaXMuX3N0eWxlWycuJyArIENsYXNzXSArICc7JykgOiAnJyk7XG4gICAgfVxuICAgIGRlbGV0ZSBhdHRycy5jbGFzcztcbiAgfVxuICAvL+WkhOeQhuWxnuaAp1xuICBzd2l0Y2ggKG5hbWUpIHtcbiAgICBjYXNlICdkaXYnOlxuICAgIGNhc2UgJ3AnOlxuICAgICAgaWYgKGF0dHJzLmFsaWduKSB7XG4gICAgICAgIGF0dHJzLnN0eWxlICs9ICgnO3RleHQtYWxpZ246JyArIGF0dHJzLmFsaWduKTtcbiAgICAgICAgZGVsZXRlIGF0dHJzLmFsaWduO1xuICAgICAgfVxuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnaW1nJzpcbiAgICAgIGlmIChhdHRycy53aWR0aCkge1xuICAgICAgICBhdHRycy5zdHlsZSA9ICd3aWR0aDonICsgYXR0cnMud2lkdGggKyAoL1swLTldLy50ZXN0KGF0dHJzLndpZHRoW2F0dHJzLndpZHRoLmxlbmd0aCAtIDFdKSA/ICdweCcgOiAnJykgKyAnOycgKyBhdHRycy5zdHlsZTtcbiAgICAgICAgZGVsZXRlIGF0dHJzLndpZHRoO1xuICAgICAgfVxuICAgICAgaWYgKGF0dHJzWydkYXRhLXNyYyddKSB7XG4gICAgICAgIGF0dHJzLnNyYyA9IGF0dHJzLnNyYyB8fCBhdHRyc1snZGF0YS1zcmMnXTtcbiAgICAgICAgZGVsZXRlIGF0dHJzWydkYXRhLXNyYyddO1xuICAgICAgfVxuICAgICAgaWYgKCFhdHRycy5oYXNPd25Qcm9wZXJ0eSgnaWdub3JlJykgJiYgYXR0cnMuc3JjKSB7XG4gICAgICAgIHRoaXMuaW1nTGlzdC5wdXNoKGF0dHJzLnNyYyk7XG4gICAgICAgIGlmICh0aGlzLl9idWJibGluZygpID09ICdhJykgYXR0cnMuaWdub3JlID0gXCJcIjtcbiAgICAgIH07XG4gICAgICBicmVhaztcbiAgICBjYXNlICdmb250JzpcbiAgICAgIG5hbWUgPSAnc3Bhbic7XG4gICAgICBpZiAoYXR0cnMuY29sb3IpIHtcbiAgICAgICAgYXR0cnMuc3R5bGUgKz0gKCc7Y29sb3I6JyArIGF0dHJzLmNvbG9yKTtcbiAgICAgICAgZGVsZXRlIGF0dHJzLmNvbG9yO1xuICAgICAgfVxuICAgICAgaWYgKGF0dHJzLmZhY2UpIHtcbiAgICAgICAgYXR0cnMuc3R5bGUgKz0gKFwiO2ZvbnQtZmFtaWx5OlwiICsgYXR0cnMuZmFjZSk7XG4gICAgICAgIGRlbGV0ZSBhdHRycy5mYWNlO1xuICAgICAgfVxuICAgICAgaWYgKGF0dHJzLnNpemUpIHtcbiAgICAgICAgdmFyIHNpemUgPSBwYXJzZUludChhdHRycy5zaXplKTtcbiAgICAgICAgaWYgKHNpemUgPCAxKSBzaXplID0gMTtcbiAgICAgICAgZWxzZSBpZiAoc2l6ZSA+IDcpIHNpemUgPSA3O1xuICAgICAgICBzd2l0Y2ggKHNpemUpIHtcbiAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICBzaXplID0gMTA7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICBzaXplID0gMTM7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICBzaXplID0gMTY7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgICBzaXplID0gMTg7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIDU6XG4gICAgICAgICAgICBzaXplID0gMjQ7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIDY6XG4gICAgICAgICAgICBzaXplID0gMzI7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIDc6XG4gICAgICAgICAgICBzaXplID0gNDg7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBhdHRycy5zdHlsZSArPSAoXCI7Zm9udC1zaXplOlwiICsgc2l6ZSArIFwicHhcIik7XG4gICAgICAgIGRlbGV0ZSBhdHRycy5zaXplO1xuICAgICAgfVxuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnYSc6XG4gICAgICB0aGlzLl9idWJibGluZygpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAndmlkZW8nOlxuICAgIGNhc2UgJ2F1ZGlvJzpcbiAgICAgIGF0dHJzLmxvb3AgPSBhdHRycy5oYXNPd25Qcm9wZXJ0eSgnbG9vcCcpO1xuICAgICAgYXR0cnMuY29udHJvbHMgPSBhdHRycy5oYXNPd25Qcm9wZXJ0eSgnY29udHJvbHMnKTtcbiAgICAgIGF0dHJzLmF1dG9wbGF5ID0gYXR0cnMuaGFzT3duUHJvcGVydHkoJ2F1dG9wbGF5Jyk7XG4gICAgICBpZiAobmFtZSA9PSAndmlkZW8nKSB7XG4gICAgICAgIGF0dHJzLm11dGVkID0gYXR0cnMuaGFzT3duUHJvcGVydHkoJ211dGVkJyk7XG4gICAgICAgIGlmIChhdHRycy53aWR0aCkge1xuICAgICAgICAgIGF0dHJzLnN0eWxlID0gJ3dpZHRoOicgKyBwYXJzZUZsb2F0KGF0dHJzLndpZHRoKSArICdweDsnICsgYXR0cnMuc3R5bGU7XG4gICAgICAgICAgZGVsZXRlIGF0dHJzLndpZHRoO1xuICAgICAgICB9XG4gICAgICAgIGlmIChhdHRycy5oZWlnaHQpIHtcbiAgICAgICAgICBhdHRycy5zdHlsZSA9ICdoZWlnaHQ6JyArIHBhcnNlRmxvYXQoYXR0cnMuaGVpZ2h0KSArICdweDsnICsgYXR0cnMuc3R5bGU7XG4gICAgICAgICAgZGVsZXRlIGF0dHJzLmhlaWdodDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgYXR0cnMuaWQgPSAobmFtZSArICgrK3RoaXNbJ18nICsgbmFtZSArICdOdW0nXSkpO1xuICAgICAgYXR0cnMuc291cmNlID0gW107XG4gICAgICBpZiAoYXR0cnMuc3JjKSBhdHRycy5zb3VyY2UucHVzaChhdHRycy5zcmMpO1xuICAgICAgaWYgKCFhdHRycy5jb250cm9scyAmJiAhYXR0cnMuYXV0b3BsYXkpXG4gICAgICAgIGNvbnNvbGUud2Fybign5a2Y5Zyo5rKh5pyJY29udHJvbHPlsZ7mgKfnmoQnICsgbmFtZSArICfmoIfnrb7vvIzlj6/og73lr7zoh7Tml6Dms5Xmkq3mlL4nLCBhdHRycyk7XG4gICAgICB0aGlzLl9idWJibGluZygpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnc291cmNlJzpcbiAgICAgIGxldCBwYXJlbnQgPSB0aGlzLl90YWdTdGFja1t0aGlzLl90YWdTdGFjay5sZW5ndGggLSAxXTtcbiAgICAgIGlmIChwYXJlbnQgJiYgKHBhcmVudC5uYW1lID09ICd2aWRlbycgfHwgcGFyZW50Lm5hbWUgPT0gJ2F1ZGlvJykpIHtcbiAgICAgICAgcGFyZW50LmF0dHJzLnNvdXJjZS5wdXNoKGF0dHJzLnNyYyk7XG4gICAgICAgIGlmICghcGFyZW50LmF0dHJzLnNyYykgcGFyZW50LmF0dHJzLnNyYyA9IGF0dHJzLnNyYztcbiAgICAgIH1cbiAgICAgIHRoaXMuX3RhZ1N0YWNrLnB1c2goZWxlbWVudCk7XG4gICAgICByZXR1cm47XG4gIH1cbiAgYXR0cnMuc3R5bGUgPSBtYXRjaGVkICsgYXR0cnMuc3R5bGU7XG4gIGlmICh0ZXh0VGFnW25hbWVdKSBlbGVtZW50LmNvbnRpbnVlID0gdHJ1ZTtcbiAgZWxzZSBpZiAoYmxvY2tUYWdbbmFtZV0pIG5hbWUgPSAnZGl2JztcbiAgZWxzZSBpZiAoIXRydXN0VGFnW25hbWVdKSBuYW1lID0gJ3NwYW4nO1xuICBlbGVtZW50Lm5hbWUgPSBuYW1lO1xuICBlbGVtZW50LmF0dHJzID0gYXR0cnM7XG4gIHRoaXMuX2FkZERvbUVsZW1lbnQoZWxlbWVudCk7XG4gIHRoaXMuX3RhZ1N0YWNrLnB1c2goZWxlbWVudCk7XG59O1xuRG9tSGFuZGxlci5wcm90b3R5cGUub250ZXh0ID0gZnVuY3Rpb24oZGF0YSkge1xuICBpZiAoL1xcUy8udGVzdChkYXRhKSkge1xuICAgIGxldCBlbGVtZW50ID0ge1xuICAgICAgdGV4dDogZGF0YS5yZXBsYWNlKC8mbmJzcDsvZywgJ1xcdTAwQTAnKSxcbiAgICAgIHR5cGU6ICd0ZXh0J1xuICAgIH07XG4gICAgaWYgKC8mIyooKD8hc3B8bHR8Z3QpLil7Miw1fTsvLnRlc3QoZGF0YSkpIGVsZW1lbnQuZGVjb2RlID0gdHJ1ZTtcbiAgICB0aGlzLl9hZGREb21FbGVtZW50KGVsZW1lbnQpO1xuICB9XG59O1xuRG9tSGFuZGxlci5wcm90b3R5cGUub25jbG9zZXRhZyA9IGZ1bmN0aW9uKG5hbWUpIHtcbiAgbGV0IGVsZW1lbnQgPSB0aGlzLl90YWdTdGFjay5wb3AoKTtcbiAgaWYgKGlnbm9yZVRhZ1tuYW1lXSkge1xuICAgIGlmIChuYW1lID09ICd0aXRsZScpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHRoaXMudGl0bGUgPSBlbGVtZW50LmNoaWxkcmVuWzBdLnRleHQ7XG4gICAgICB9IGNhdGNoIChlKSB7fVxuICAgIH1cbiAgICBsZXQgcGFyZW50ID0gdGhpcy5fdGFnU3RhY2tbdGhpcy5fdGFnU3RhY2subGVuZ3RoIC0gMV07XG4gICAgbGV0IHNpYmxpbmdzID0gcGFyZW50ID8gcGFyZW50LmNoaWxkcmVuIDogdGhpcy5ub2RlcztcbiAgICBzaWJsaW5ncy5wb3AoKTtcbiAgfVxufTtcbm1vZHVsZS5leHBvcnRzID0gRG9tSGFuZGxlcjsiXX0=